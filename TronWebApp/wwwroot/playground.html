<html>
<head>
    <meta charset="UTF-8">
    <title>Playground Example</title>
    <style>
        body {
            overflow: hidden;
            margin: 0;
        }

        button:disabled {
            border: 1px solid #999999;
            background-color: #cccccc;
            color: #666666;
        }

        #playground {
            border: 3px solid black;
        }
    </style>
</head>
<body>
    <table>
        <tr>
            <td>
                <canvas id="playground"></canvas>
            </td>
            <td style="width: 300px; height: 100px; background-color: lightgray; padding: 10px;">
                <div>
                    <p>
                        <b>Controls:</b>
                        <ul>
                            <li>Left: <span>&#8592;</span>, A</li>
                            <li>Right: <span>&#8594;</span>, D</li>
                            <li>Up: <span>&#8593;</span>, W</li>
                            <li>Down: <span>&#8595;</span>, S</li>
                        </ul>
                    </p>

                    <button id="find-game-button">Find Game</button>
                    <button id="forfeit-game-button" disabled>Forfeit Game</button>
                </div>
            </td>
        </tr>
    </table>


    <script src="js/lib/signalr.js"></script>
    <script src="js/signalr-client.js"></script>
    <script src="js/tron-game.js"></script>

    <script>
        "use strict";

        let game = null;
        let findGameButton = null;
        let forfeitGameButton = null;
        let canvas = null;

        function onWindowLoaded() {
            canvas = document.getElementById('playground');
            canvas.width = defaultBoardWidth;
            canvas.height = defaultBoardHeight;

            let commClient = new SignalRClient();
            game = new TronGame(canvas, commClient);
            game.onGameStarted = onGameStarted;
            game.onGameFinished = onGameFinished;

            findGameButton = document.getElementById("find-game-button");
            findGameButton.addEventListener('click', findGame);

            forfeitGameButton = document.getElementById("forfeit-game-button");
            forfeitGameButton.addEventListener('click', forfeitGame);

            window.addEventListener('resize', onWindowResized);

            window.removeEventListener('load', onWindowLoaded);

            onWindowResized();
        }

        window.addEventListener('load', onWindowLoaded);

        function onWindowResized() {
            if (playgroundResized(canvas)) {
                game.resize(canvas.width, canvas.height);
            }
        }
        function playgroundResized(canvas) {
            let width = document.body.clientWidth - 300;
            let height = document.body.clientHeight - 10;

            if (canvas.width !== width || canvas.height !== height) {
                canvas.width = width;
                canvas.height = height;

                return true;
            }

            return false;
        }

        function forfeitGame() {
            game.forfeitGame();
        }

        function findGame() {
            findGameButton.disabled = true;
            forfeitGameButton.disabled = false;

            game.findGame();
        }

        function onGameFinished() {
            document.removeEventListener("keydown", keyDown);
            findGameButton.disabled = false;
            forfeitGameButton.disabled = true;
        }

        function onGameStarted(model) {
            document.addEventListener("keydown", keyDown);
        }

        function keyDown(evt) {
            let direction = directionEnum.none;

            switch (evt.code) {
                case 'ArrowLeft':
                case 'KeyA':
                    direction = directionEnum.left;
                    break;
                case 'ArrowUp':
                case 'KeyW':
                    direction = directionEnum.up;
                    break;
                case 'ArrowRight':
                case 'KeyD':
                    direction = directionEnum.right;
                    break;
                case 'ArrowDown':
                case 'KeyS':
                    direction = directionEnum.down;
                    break;
            }

            game.changeDirection(direction);
        }
    </script>
</body>
</html>